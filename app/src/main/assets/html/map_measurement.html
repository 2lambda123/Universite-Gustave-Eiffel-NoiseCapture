<!DOCTYPE html>
<html>
<head>
	
	<title>Measurement map</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
    <link rel="stylesheet" href="style/leaflet.css"/>
	<link rel="stylesheet" href="style/easy-button.css"/>
	<link rel="stylesheet" href="style/control_icons.css"/>
	<link rel="stylesheet" href="style/style.css"/>
    <script src="js/leaflet.js"></script>
	<script src="js/easy-button.js"></script>


	<style>
		#map {
			width: 600px;
			height: 400px;
		}
	</style>

	<style>body { padding: 0; margin: 0; } html, body, #map { height: 100vh; width: 100vw; }</style>
</head>
<body>

<div id='map'></div>

<script>
	var map = L.map('map').fitWorld();
	var autoTrack = true;

	map.on('dragstart', function() {
	  autoTrack = false;
	})


	L.control.scale({
		'position': 'bottomright',
		'metric': true,
		'imperial': false
	}).addTo(map);

	var autoTrackButton = L.easyButton('icon-dot-circled icon-dot-circled-1px', function(btn, map){
		autoTrack = true;
		if(userLocationPoint.LatLng != null) {
     		map.flyTo(userLocationPoint.LatLng, 18);
		}
	}).addTo( map );

	var userLocationPrecision = L.circle([0., 0.], {
    color: '#deebf7',
    fillColor: '#deebf7',
    fillOpacity: 0.5,
    radius: 12,
    stroke: false
	});

	var userLocationPoint = L.circleMarker([0., 0.], {
    color: '#ffffff',
    fillColor: '#2b8cbe',
    weight: 1.,
    fillOpacity: 1.,
    radius: 4
	});

	var userLocationLayer = L.layerGroup( [userLocationPrecision, userLocationPoint] , {zIndex: 3});

	var userMeasurementPoints = L.layerGroup();

	function updateLocation(newLoc, precision) {
     userLocationPrecision.setLatLng(newLoc)
     userLocationPrecision.setRadius(precision)
     userLocationPoint.setLatLng(newLoc)
     if(autoTrack) {
     	map.flyTo(newLoc, 18)
	 }
    }

    function addMeasurementPoint(loc, color) {
		userMeasurementPoints.addLayer(L.circleMarker(loc, {
			color: '#ffffff',
			fillColor: color,
			weight: 0.,
			fillOpacity: 1.,
			radius: 2,
			stroke: false,
        	zIndex: 4
			}));
    }

    userMeasurementPoints.addTo(map);

	var onomap = L.tileLayer('http://onomap-gs.noise-planet.org/geoserver/gwc/service/tms/1.0.0/noisecapture:noisecapture_area@EPSG:900913@png/{z}/{x}/{y}.png', {
	"attribution": "<a href='http://onomap-gs.noise-planet.org'>OnoMap server</a>",
	tms: true,
	zIndex: 2,
	opacity: 0.5,
	minZoom: 14
	});

    var osm = L.tileLayer('http://a.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
        zIndex: 1
    });
    
    
    osm.addTo(map);
    onomap.addTo(map);
</script>



</body>
</html>
